import{c as y}from"./cartStore-64zcOpiM.js";import{_ as w,m as x,a as E,r as C,o as n,c as i,b as t,F as k,g as I,t as c,h as m,i as V,v as L,d as u,w as U,n as A,e as f,j as v}from"./index-Ntgc_m6i.js";import{M as P}from"./bootstrap.esm-TTjMTX3M.js";var T={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"iris831206",BASE_URL:"/vue-sample-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:h,VITE_API_PATH:p}=T,S={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:"",delCartModal:null}},methods:{openDelCartModal(){this.delCartModal.show()},getProducts(){const o=`${h}/api/${p}/products`;this.isLoading=!0,this.$http.get(o).then(s=>{this.products=s.data.products,this.isLoading=!1}).catch(s=>{this.isLoading=!1,alert(s.response.data.message)})},getProduct(o){this.$router.push(`product/${o}`)},...x(y,["addToCart"]),deleteAllCarts(){this.isLoading=!0;const o=`${h}/api/${p}/carts`;this.$http.delete(o).then(s=>{this.delCartModal.hide(),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,alert(s.response.data.message)})},...x(y,["getCart"]),removeCartItem(o){this.status.loadingItem=o;const s=`${h}/api/${p}/cart/${o}`;this.isLoading=!0,this.$http.delete(s).then(d=>{alert(d.data.message),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(d=>{this.isLoading=!1,alert(d.response.data.message)})},updateCart(o){this.isLoading=!0;const s=`${h}/api/${p}/cart/${o.id}`,d={product_id:o.product_id,qty:o.qty};this.$http.put(s,{data:d}).then(_=>{alert(_.data.message),this.isLoading=!1,this.getCart()}).catch(_=>{this.isLoading=!1,alert(_.response.data.message)})},addCouponCode(){const o=`${h}/api/${p}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(o,{data:s}).then(d=>{alert(d.data.message),this.getCart(),this.isLoading=!1}).catch(d=>{this.isLoading=!1,alert(d.response.data.message)})},createOrder(){this.isLoading=!0;const o=`${h}/api/${p}/order`,s=this.form;this.$http.post(o,{data:s}).then(d=>{this.$router.push(`checkout/${d.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(d=>{this.isLoading=!1,alert(d.response.data.message)})}},computed:{...E(y,["carts","total","final_total"])},mounted(){this.delCartModal=new P(this.$refs.delCartModal),this.getProducts(),this.getCart()}},q={class:"container"},D={class:"mt-4"},F={class:"table align-middle"},$=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th",null,"功能")])],-1),B={style:{width:"200px"}},R={href:"#",class:"text-dark"},N={key:0,class:"h5"},O={key:1,class:"h6"},z={key:2,class:"h5"},j={class:"btn-group btn-group-sm"},H=["disabled","onClick"],G={key:0,class:"spinner-border spinner-grow-sm"},J=["onClick","disabled"],K={key:0,class:"spinner-border spinner-grow-sm"},Q={class:"text-end"},W={class:"table align-middle"},X=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"135px"}},"數量"),t("th",null,"小計")])],-1),Y=["disabled","onClick"],Z=t("i",{class:"bi bi-x"},null,-1),tt=[Z],et={key:0,class:"text-success"},st={class:"input-group input-group-sm"},ot=["onUpdate:modelValue","onBlur"],lt={class:"input-group-text"},at={class:"text-end"},dt={key:0,class:"text-success"},nt={key:1},it=t("td",{colspan:"4",class:"text-center"},"目前沒有品項",-1),rt=[it],ct=t("td",{colspan:"3",class:"text-end"},"總計",-1),ut={class:"text-end"},mt={key:0},ht=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),pt={class:"text-end text-success"},_t={class:"input-group mb-3 input-group-sm"},bt={class:"input-group-append"},gt={class:"my-5 row justify-content-center"},ft={class:"mb-3"},vt=t("label",{for:"email",class:"form-label"},"Email",-1),yt={class:"mb-3"},Ct=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),kt={class:"mb-3"},Vt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Lt={class:"mb-3"},xt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),It={class:"mb-3"},Mt=t("label",{for:"message",class:"form-label"},"留言",-1),wt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),Et={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delCartModal"},Ut={class:"modal-dialog",role:"document"},At={class:"modal-content border-0"},Pt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{class:"modal-title"},[t("span",null,"清除購物車")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Tt=t("div",{class:"modal-body"}," 是否刪除全部品項 (刪除後將無法恢復)。 ",-1),St={class:"modal-footer"},qt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function Dt(o,s,d,_,l,r){const b=C("VeeField"),g=C("ErrorMessage"),M=C("VeeForm");return n(),i(k,null,[t("div",q,[t("div",D,[t("table",F,[$,t("tbody",null,[(n(!0),i(k,null,I(l.products,e=>(n(),i("tr",{key:e.id},[t("td",B,[t("div",{style:A([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,[t("a",R,c(e.title),1)]),t("td",null,[e.price?m("",!0):(n(),i("div",N,c(e.origin_price)+" 元 ",1)),e.price?(n(),i("del",O,"原價 "+c(e.origin_price)+" 元",1)):m("",!0),e.price?(n(),i("div",z," 現在只要 "+c(e.price)+" 元 ",1)):m("",!0)]),t("td",null,[t("div",j,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:l.status.loadingItem===e.id||!e.is_enabled,onClick:a=>r.getProduct(e.id)},[l.status.loadingItem===e.id?(n(),i("span",G)):m("",!0),f(" 查看更多 ")],8,H),t("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>o.addToCart(e.id),disabled:l.status.loadingItem===e.id||!e.is_enabled},[l.status.loadingItem===e.id?(n(),i("span",K)):m("",!0),f(" 加到購物車 ")],8,J)])])]))),128))])]),t("div",Q,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...e)=>r.openDelCartModal&&r.openDelCartModal(...e))}," 清空購物車 ")]),t("table",W,[X,t("tbody",null,[o.carts&&o.carts.length>0?(n(!0),i(k,{key:0},I(o.carts,e=>(n(),i("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.status.loadingItem===e.id,onClick:a=>r.removeCartItem(e.id)},tt,8,Y)]),t("td",null,[f(c(e.product.title)+" ",1),e.coupon?(n(),i("div",et,"已套用優惠券")):m("",!0)]),t("td",null,[t("div",st,[V(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a=>e.qty=a,onBlur:a=>r.updateCart(e)},null,40,ot),[[L,e.qty,void 0,{number:!0}]]),t("div",lt,"/ "+c(e.product.unit),1)])]),t("td",at,[o.final_total!==o.total?(n(),i("small",dt,"折扣價：")):m("",!0),f(" "+c(e.final_total),1)])]))),128)):(n(),i("tr",nt,rt))]),t("tfoot",null,[t("tr",null,[ct,t("td",ut,c(o.total),1)]),o.final_total!==o.total?(n(),i("tr",mt,[ht,t("td",pt,c(o.final_total),1)])):m("",!0)])]),t("div",_t,[V(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>l.coupon_code=e),placeholder:"請輸入優惠碼"},null,512),[[L,l.coupon_code]]),t("div",bt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...e)=>r.addCouponCode&&r.addCouponCode(...e))}," 套用優惠碼 ")])])]),t("div",gt,[u(M,{ref:"form",class:"col-md-6",onSubmit:r.createOrder},{default:U(({errors:e})=>[t("div",ft,[vt,u(b,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),u(g,{name:"email",class:"invalid-feedback"})]),t("div",yt,[Ct,u(b,{id:"name",name:"姓名",type:"text",class:v(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),u(g,{name:"姓名",class:"invalid-feedback"})]),t("div",kt,[Vt,u(b,{id:"tel",name:"電話",type:"tel",class:v(["form-control",{"is-invalid":e.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=a=>l.form.user.tel=a)},null,8,["class","modelValue"]),u(g,{name:"電話",class:"invalid-feedback"})]),t("div",Lt,[xt,u(b,{id:"address",name:"地址",type:"text",class:v(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),u(g,{name:"地址",class:"invalid-feedback"})]),t("div",It,[Mt,V(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=a=>l.form.message=a)},null,512),[[L,l.form.message]])]),wt]),_:1},8,["onSubmit"])])]),t("div",Et,[t("div",Ut,[t("div",At,[Pt,Tt,t("div",St,[qt,t("button",{type:"button",class:"btn btn-danger",onClick:s[8]||(s[8]=(...e)=>r.deleteAllCarts&&r.deleteAllCarts(...e))},"確認刪除 ")])])])],512)],64)}const Rt=w(S,[["render",Dt]]);export{Rt as default};
