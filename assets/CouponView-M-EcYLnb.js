import{P as v}from"./PaginationComponents-W6W-JLXQ.js";import{M as m}from"./bootstrap.esm-TTjMTX3M.js";import{_ as y,r as M,o as d,c as i,b as o,F as x,g as k,t as p,e as b,i as u,v as c,q as L,d as w}from"./index-Ntgc_m6i.js";var P={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"iris831206",BASE_URL:"/vue-sample-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:r,VITE_API_PATH:_}=P,V={data(){return{coupons:{},due_date:"",tempCoupon:{title:"",is_enabled:0,percent:100,code:"",due_date:""},isLoading:!1,isNew:!1,couponModal:null,delCouponModal:null,currentPage:1,pagination:{}}},methods:{openCouponModal(n,t){this.isNew=n,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...t},this.couponModal.show()},openDelCouponModal(n){this.tempCoupon={...n},this.delCouponModal.show()},updateCoupon(n){this.isLoading=!0;let t=`${r}/api/${_}/admin/coupon`,l="post",h=n;this.isNew||(t=`${r}/api/${_}/admin/coupon/${this.tempCoupon.id}`,l="put",h=this.tempCoupon),this.$http[l](t,{data:h}).then(e=>{this.isLoading=!1,alert(e.data.message),this.getCoupons(),this.couponModal.hide()}).catch(e=>{this.isLoading=!1,alert(e.response.data.message)})},delCoupon(){const n=`${r}/api/${_}/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(n).then(t=>{this.isLoading=!1,this.delCouponModal.hide(),this.getCoupons()}).catch(t=>{this.isLoading=!1,alert(t.response.data.message)})},getCoupons(n=1){this.currentPage=n,this.isLoading=!0;const t=`${r}/api/${_}/admin/coupons?page=${n}`;this.$http.get(t,this.tempProduct).then(l=>{this.coupons=l.data.coupons,this.pagination=l.data.pagination,this.isLoading=!1}).catch(l=>{this.isLoading=!1,alert(l.response.data.message)})}},components:{PaginationComponents:v},mounted(){this.couponModal=new m(this.$refs.couponModal),this.delCouponModal=new m(this.$refs.delCouponModal),this.getCoupons()}},D={class:"container"},E={class:"text-end mt-4"},T={class:"table mt-4"},N=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),I={key:0,class:"text-success"},U={key:1,class:"text-muted"},A={class:"btn-group"},R=["onClick"],S=["onClick"],B={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delCouponModal"},F={class:"modal-dialog",role:"document"},H={class:"modal-content border-0"},O={class:"modal-header bg-danger text-white"},q={class:"modal-title"},z=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),W={class:"modal-body"},j={class:"text-danger"},G={class:"modal-footer"},J=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1),K={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"couponModal"},Q={class:"modal-dialog",role:"document"},X={class:"modal-content"},Y={class:"modal-header"},Z={class:"modal-title",id:"exampleModalLabel"},$={key:0},oo={key:1},to=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),eo={class:"modal-body"},so={class:"mb-3"},no=o("label",{for:"title"},"標題",-1),lo={class:"mb-3"},ao=o("label",{for:"coupon_code"},"優惠碼",-1),io={class:"mb-3"},po=o("label",{for:"due_date"},"到期日",-1),uo={class:"mb-3"},co=o("label",{for:"price"},"折扣百分比",-1),ro={class:"mb-3"},_o={class:"form-check"},ho=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),mo={class:"modal-footer"},bo=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function Co(n,t,l,h,e,a){const C=M("PaginationComponents");return d(),i("div",D,[o("div",E,[o("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=s=>a.openCouponModal(!0))}," 建立新的優惠券 ")]),o("table",T,[N,o("tbody",null,[(d(!0),i(x,null,k(e.coupons,(s,g)=>(d(),i("tr",{key:g},[o("td",null,p(s.title),1),o("td",null,p(s.percent)+"%",1),o("td",null,p(new Date(s.due_date*1e3).toLocaleDateString("zh-TW")),1),o("td",null,[s.is_enabled===1?(d(),i("span",I,"啟用")):(d(),i("span",U,"未啟用"))]),o("td",null,[o("div",A,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:f=>a.openCouponModal(!1,s)},"編輯",8,R),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>a.openDelCouponModal(s)},"刪除",8,S)])])]))),128))])]),o("div",B,[o("div",F,[o("div",H,[o("div",O,[o("h5",q,[o("span",null,"刪除 "+p(e.tempCoupon.title),1)]),z]),o("div",W,[b(" 是否刪除 "),o("strong",j,p(e.tempCoupon.title),1),b(" (刪除後將無法恢復)。 ")]),o("div",G,[J,o("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...s)=>a.delCoupon&&a.delCoupon(...s))},"確認刪除 ")])])])],512),o("div",K,[o("div",Q,[o("div",X,[o("div",Y,[o("h5",Z,[e.isNew?(d(),i("span",$,"新增優惠卷")):(d(),i("span",oo,"編輯優惠卷"))]),to]),o("div",eo,[o("div",so,[no,u(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[2]||(t[2]=s=>e.tempCoupon.title=s),placeholder:"請輸入標題"},null,512),[[c,e.tempCoupon.title]])]),o("div",lo,[ao,u(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[3]||(t[3]=s=>e.tempCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[c,e.tempCoupon.code]])]),o("div",io,[po,u(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[4]||(t[4]=s=>e.due_date=s)},null,512),[[c,e.due_date]])]),o("div",uo,[co,u(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[5]||(t[5]=s=>e.tempCoupon.percent=s),placeholder:"請輸入折扣百分比"},null,512),[[c,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",ro,[o("div",_o,[u(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[6]||(t[6]=s=>e.tempCoupon.is_enabled=s),id:"is_enabled"},null,512),[[L,e.tempCoupon.is_enabled]]),ho])])]),o("div",mo,[bo,o("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=s=>a.updateCoupon(e.tempCoupon))},p(e.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512),w(C,{pages:e.pagination,onEmitPages:a.getCoupons},null,8,["pages","onEmitPages"])])}const yo=y(V,[["render",Co]]);export{yo as default};
