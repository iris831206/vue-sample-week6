import{c as C}from"./cartStore-JyK-h-9z.js";import{_ as E,m as x,a as U,r as f,o as d,c as i,d as c,b as t,F as k,g as I,t as u,h as m,i as V,v as L,w as A,n as P,e as v,j as y}from"./index-xzrc9yqT.js";import{M as T}from"./bootstrap.esm-TTjMTX3M.js";var S={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"iris831206",BASE_URL:"/vue-sample-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:h,VITE_API_PATH:p}=S,q={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:"",delCartModal:null}},methods:{openDelCartModal(){this.delCartModal.show()},getProducts(){const o=`${h}/api/${p}/products`;this.isLoading=!0,this.$http.get(o).then(s=>{this.products=s.data.products,this.isLoading=!1}).catch(s=>{this.isLoading=!1,alert(s.response.data.message)})},getProduct(o){this.$router.push(`product/${o}`)},...x(C,["addToCart"]),deleteAllCarts(){this.isLoading=!0;const o=`${h}/api/${p}/carts`;this.$http.delete(o).then(s=>{this.delCartModal.hide(),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,alert(s.response.data.message)})},...x(C,["getCart"]),removeCartItem(o){this.status.loadingItem=o;const s=`${h}/api/${p}/cart/${o}`;this.isLoading=!0,this.$http.delete(s).then(n=>{alert(n.data.message),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(n=>{this.isLoading=!1,alert(n.response.data.message)})},updateCart(o){this.isLoading=!0;const s=`${h}/api/${p}/cart/${o.id}`,n={product_id:o.product_id,qty:o.qty};this.$http.put(s,{data:n}).then(_=>{alert(_.data.message),this.isLoading=!1,this.getCart()}).catch(_=>{this.isLoading=!1,alert(_.response.data.message)})},addCouponCode(){const o=`${h}/api/${p}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(o,{data:s}).then(n=>{alert(n.data.message),this.getCart(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,alert(n.response.data.message)})},createOrder(){this.isLoading=!0;const o=`${h}/api/${p}/order`,s=this.form;this.$http.post(o,{data:s}).then(n=>{this.$router.push(`checkout/${n.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(n=>{this.isLoading=!1,alert(n.response.data.message)})}},computed:{...U(C,["carts","total","final_total"])},mounted(){this.delCartModal=new T(this.$refs.delCartModal),this.getProducts(),this.getCart()}},D={class:"container"},F={class:"mt-4"},B={class:"table align-middle"},$=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th",null,"功能")])],-1),R={style:{width:"200px"}},z={href:"#",class:"text-dark"},N={key:0,class:"h5"},O={key:1,class:"h6"},j={key:2,class:"h5"},H={class:"btn-group btn-group-sm"},G=["disabled","onClick"],J={key:0,class:"spinner-border spinner-grow-sm"},K=["onClick","disabled"],Q={key:0,class:"spinner-border spinner-grow-sm"},W={class:"text-end"},X={class:"table align-middle"},Y=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"135px"}},"數量"),t("th",null,"小計")])],-1),Z=["disabled","onClick"],tt=t("i",{class:"bi bi-x"},null,-1),et=[tt],st={key:0,class:"text-success"},ot={class:"input-group input-group-sm"},lt=["onUpdate:modelValue","onBlur"],at={class:"input-group-text"},nt={class:"text-end"},dt={key:0,class:"text-success"},it={key:1},rt=t("td",{colspan:"4",class:"text-center"},"目前沒有品項",-1),ct=[rt],ut=t("td",{colspan:"3",class:"text-end"},"總計",-1),mt={class:"text-end"},ht={key:0},pt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),_t={class:"text-end text-success"},bt={class:"input-group mb-3 input-group-sm"},gt={class:"input-group-append"},ft={class:"my-5 row justify-content-center"},vt={class:"mb-3"},yt=t("label",{for:"email",class:"form-label"},"Email",-1),Ct={class:"mb-3"},kt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Vt={class:"mb-3"},Lt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),xt={class:"mb-3"},It=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Mt={class:"mb-3"},wt=t("label",{for:"message",class:"form-label"},"留言",-1),Et=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),Ut={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delCartModal"},At={class:"modal-dialog",role:"document"},Pt={class:"modal-content border-0"},Tt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{class:"modal-title"},[t("span",null,"清除購物車")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),St=t("div",{class:"modal-body"}," 是否刪除全部品項 (刪除後將無法恢復)。 ",-1),qt={class:"modal-footer"},Dt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function Ft(o,s,n,_,l,r){const M=f("VueLoading"),b=f("VeeField"),g=f("ErrorMessage"),w=f("VeeForm");return d(),i(k,null,[c(M,{active:l.isLoading,"z-index":1060},null,8,["active"]),t("div",D,[t("div",F,[t("table",B,[$,t("tbody",null,[(d(!0),i(k,null,I(l.products,e=>(d(),i("tr",{key:e.id},[t("td",R,[t("div",{style:P([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,[t("a",z,u(e.title),1)]),t("td",null,[e.price?m("",!0):(d(),i("div",N,u(e.origin_price)+" 元 ",1)),e.price?(d(),i("del",O,"原價 "+u(e.origin_price)+" 元",1)):m("",!0),e.price?(d(),i("div",j," 現在只要 "+u(e.price)+" 元 ",1)):m("",!0)]),t("td",null,[t("div",H,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:l.status.loadingItem===e.id||!e.is_enabled,onClick:a=>r.getProduct(e.id)},[l.status.loadingItem===e.id?(d(),i("span",J)):m("",!0),v(" 查看更多 ")],8,G),t("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>o.addToCart(e.id),disabled:l.status.loadingItem===e.id||!e.is_enabled},[l.status.loadingItem===e.id?(d(),i("span",Q)):m("",!0),v(" 加到購物車 ")],8,K)])])]))),128))])]),t("div",W,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...e)=>r.openDelCartModal&&r.openDelCartModal(...e))}," 清空購物車 ")]),t("table",X,[Y,t("tbody",null,[o.carts&&o.carts.length>0?(d(!0),i(k,{key:0},I(o.carts,e=>(d(),i("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.status.loadingItem===e.id,onClick:a=>r.removeCartItem(e.id)},et,8,Z)]),t("td",null,[v(u(e.product.title)+" ",1),e.coupon?(d(),i("div",st,"已套用優惠券")):m("",!0)]),t("td",null,[t("div",ot,[V(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a=>e.qty=a,onBlur:a=>r.updateCart(e)},null,40,lt),[[L,e.qty,void 0,{number:!0}]]),t("div",at,"/ "+u(e.product.unit),1)])]),t("td",nt,[o.final_total!==o.total?(d(),i("small",dt,"折扣價：")):m("",!0),v(" "+u(e.final_total),1)])]))),128)):(d(),i("tr",it,ct))]),t("tfoot",null,[t("tr",null,[ut,t("td",mt,u(o.total),1)]),o.final_total!==o.total?(d(),i("tr",ht,[pt,t("td",_t,u(o.final_total),1)])):m("",!0)])]),t("div",bt,[V(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>l.coupon_code=e),placeholder:"請輸入優惠碼"},null,512),[[L,l.coupon_code]]),t("div",gt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...e)=>r.addCouponCode&&r.addCouponCode(...e))}," 套用優惠碼 ")])])]),t("div",ft,[c(w,{ref:"form",class:"col-md-6",onSubmit:r.createOrder},{default:A(({errors:e})=>[t("div",vt,[yt,c(b,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),c(g,{name:"email",class:"invalid-feedback"})]),t("div",Ct,[kt,c(b,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),c(g,{name:"姓名",class:"invalid-feedback"})]),t("div",Vt,[Lt,c(b,{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":e.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=a=>l.form.user.tel=a)},null,8,["class","modelValue"]),c(g,{name:"電話",class:"invalid-feedback"})]),t("div",xt,[It,c(b,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),c(g,{name:"地址",class:"invalid-feedback"})]),t("div",Mt,[wt,V(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=a=>l.form.message=a)},null,512),[[L,l.form.message]])]),Et]),_:1},8,["onSubmit"])])]),t("div",Ut,[t("div",At,[t("div",Pt,[Tt,St,t("div",qt,[Dt,t("button",{type:"button",class:"btn btn-danger",onClick:s[8]||(s[8]=(...e)=>r.deleteAllCarts&&r.deleteAllCarts(...e))},"確認刪除 ")])])])],512)],64)}const zt=E(q,[["render",Ft]]);export{zt as default};
