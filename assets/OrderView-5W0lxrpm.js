import{P as v}from"./PaginationComponents-W6W-JLXQ.js";import{M as g}from"./bootstrap.esm-TTjMTX3M.js";import{_ as x,r as M,o,c as d,b as t,F as h,g as u,t as l,h as p,i as O,q as f,e as y,d as C,j as w}from"./index-Ntgc_m6i.js";var L={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"iris831206",BASE_URL:"/vue-sample-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:m,VITE_API_PATH:b}=L,P={data(){return{orders:{},isNew:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1,OrderModal:null,delOrderModal:null}},methods:{openModal(n){this.tempOrder={...n},this.isNew=!1,this.OrderModal.show()},openDelOrderModal(n){this.tempOrder={...n},this.delOrderModal.show()},updatePaid(n){this.isLoading=!0;const a=`${m}/api/${b}/admin/order/${n.id}`,r={is_paid:n.is_paid};this.$http.put(a,{data:r}).then(_=>{this.isLoading=!1,this.OrderModal.hide(),this.getOrders(this.currentPage)}).catch(_=>{this.isLoading=!1,alert(_.response.data.message)})},delOrder(){const n=`${m}/api/${b}/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(n).then(()=>{this.isLoading=!1,this.delOrderModal.hide(),this.getOrders(this.currentPage)}).catch(a=>{this.isLoading=!1,alert(a.response.data.message)})},getOrders(n=1){this.currentPage=n;const a=`${m}/api/${b}/admin/orders?page=${n}`;this.isLoading=!0,this.$http.get(a,this.tempProduct).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.isLoading=!1}).catch(r=>{this.isLoading=!1,alert(r.response.data.message)})}},components:{PaginationComponents:v},mounted(){this.OrderModal=new g(this.$refs.OrderModal),this.delOrderModal=new g(this.$refs.delOrderModal),this.getOrders()}},D={class:"container"},V={class:"table mt-4"},E=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),T=["textContent"],S={class:"list-unstyled"},I={class:"text-right"},A={class:"form-check form-switch"},N=["id","onUpdate:modelValue","onChange"],U=["for"],R={key:0},z={key:1},B={class:"btn-group"},q=["onClick"],W=["onClick"],j={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"OrderModal"},F={class:"modal-dialog modal-xl",role:"document"},H={class:"modal-content border-0"},G=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-md-4"},X=t("h3",null,"用戶資料",-1),Y={class:"table"},Z={key:0},$=t("th",{style:{width:"100px"}},"姓名",-1),tt=t("th",null,"Email",-1),et=t("th",null,"電話",-1),st=t("th",null,"地址",-1),lt={class:"col-md-8"},ot=t("h3",null,"訂單細節",-1),dt={class:"table"},nt=t("th",{style:{width:"100px"}},"訂單編號",-1),at=t("th",null,"下單時間",-1),it=t("th",null,"付款時間",-1),rt={key:0},ct={key:1},ht=t("th",null,"付款狀態",-1),_t={key:0,class:"text-success"},ut={key:1,class:"text-muted"},pt=t("th",null,"總金額",-1),mt=t("h3",null,"選購商品",-1),bt={class:"table"},gt=t("thead",null,[t("tr")],-1),Ot={class:"text-end"},ft={class:"d-flex justify-content-end"},yt={class:"form-check"},kt={class:"form-check-label",for:"flexCheckDefault"},vt={key:0},xt={key:1},Mt={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),wt={class:"modal fade",id:"delOrderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delOrderModal"},Lt={class:"modal-dialog",role:"document"},Pt={class:"modal-content border-0"},Dt={class:"modal-header bg-danger text-white"},Vt={class:"modal-title"},Et=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Tt={class:"modal-body"},St={class:"text-danger"},It={class:"modal-footer"},At=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function Nt(n,a,r,_,s,c){const k=M("PaginationComponents");return o(),d(h,null,[t("div",D,[t("table",V,[E,t("tbody",null,[(o(!0),d(h,null,u(s.orders,e=>(o(),d(h,{key:e.id},[s.orders.length?(o(),d("tr",{key:0,class:w({"text-secondary":!e.is_paid})},[t("td",null,l(new Date(e.create_at*1e3).toLocaleDateString("zh-TW")),1),t("td",null,[e.user?(o(),d("span",{key:0,textContent:l(e.user.email)},null,8,T)):p("",!0)]),t("td",null,[t("ul",S,[(o(!0),d(h,null,u(e.products,i=>(o(),d("li",{key:i.id},l(i.product.title)+" 數量："+l(i.qty)+" "+l(i.product.unit),1))),128))])]),t("td",I,l(e.total),1),t("td",null,[t("div",A,[O(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${e.id}`,"onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>c.updatePaid(e)},null,40,N),[[f,e.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?(o(),d("span",R,"已付款")):(o(),d("span",z,"未付款"))],8,U)])]),t("td",null,[t("div",B,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:i=>c.openModal(e)}," 檢視 ",8,q),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:i=>c.openDelOrderModal(e)}," 刪除 ",8,W)])])],2)):p("",!0)],64))),128))])])]),t("div",j,[t("div",F,[t("div",H,[G,t("div",J,[t("div",K,[t("div",Q,[X,t("table",Y,[s.tempOrder.user?(o(),d("tbody",Z,[t("tr",null,[$,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[tt,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[et,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[st,t("td",null,l(s.tempOrder.user.address),1)])])):p("",!0)])]),t("div",lt,[ot,t("table",dt,[t("tbody",null,[t("tr",null,[nt,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[at,t("td",null,l(new Date(s.tempOrder.create_at*1e3).toLocaleDateString("zh-TW")),1)]),t("tr",null,[it,t("td",null,[s.tempOrder.paid_date?(o(),d("span",rt,l(new Date(s.tempOrder.paid_date*1e3).toLocaleDateString("zh-TW")),1)):(o(),d("span",ct,"時間不正確"))])]),t("tr",null,[ht,t("td",null,[s.tempOrder.is_paid?(o(),d("strong",_t,"已付款")):(o(),d("span",ut,"尚未付款"))])]),t("tr",null,[pt,t("td",null,l(s.tempOrder.total),1)])])]),mt,t("table",bt,[gt,t("tbody",null,[(o(!0),d(h,null,u(s.tempOrder.products,e=>(o(),d("tr",{key:e.id},[t("th",null,l(e.product.title),1),t("td",null,l(e.qty)+" / "+l(e.product.unit),1),t("td",Ot,l(e.final_total),1)]))),128))])]),t("div",ft,[t("div",yt,[O(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":a[0]||(a[0]=e=>s.tempOrder.is_paid=e)},null,512),[[f,s.tempOrder.is_paid]]),t("label",kt,[s.tempOrder.is_paid?(o(),d("span",vt,"已付款")):(o(),d("span",xt,"未付款"))])])])])])]),t("div",Mt,[Ct,t("button",{type:"button",class:"btn btn-primary",onClick:a[1]||(a[1]=e=>c.updatePaid(s.tempOrder))}," 修改付款狀態 ")])])])],512),t("div",wt,[t("div",Lt,[t("div",Pt,[t("div",Dt,[t("h5",Vt,[t("span",null,"刪除 "+l(s.tempOrder.title),1)]),Et]),t("div",Tt,[y(" 是否刪除 "),t("strong",St,l(s.tempOrder.title),1),y(" (刪除後將無法恢復)。 ")]),t("div",It,[At,t("button",{type:"button",class:"btn btn-danger",onClick:a[2]||(a[2]=(...e)=>c.delOrder&&c.delOrder(...e))},"確認刪除 ")])])])],512),C(k,{pages:s.pagination,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"])],64)}const Bt=x(P,[["render",Nt]]);export{Bt as default};
